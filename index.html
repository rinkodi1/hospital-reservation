<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>病院予約システム</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>
<body>
    <!-- メイン画面（予約者用） -->
    <div id="main-screen" class="screen active">
        <div class="container">
            <header class="header">
                <h1>病院予約システム</h1>
                <button type="button" id="admin-login-btn" class="btn btn--outline btn--sm">管理者ログイン</button>
            </header>

            <!-- 病院からのメッセージ -->
            <div class="card mb-24">
                <div class="card__body">
                    <h2>お知らせ</h2>
                    <div id="hospital-message">
                        ご来院いただきありがとうございます。オンライン予約システムをご利用ください。
                    </div>
                </div>
            </div>

            <!-- 予約フォーム -->
            <div class="card">
                <div class="card__header">
                    <h2>新規予約</h2>
                </div>
                <div class="card__body">
                    <form id="booking-form" novalidate>
                        <div class="form-group">
                            <label class="form-label" for="patient-name">お名前 *</label>
                            <input type="text" class="form-control" id="patient-name" name="patient-name" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="patient-email">メールアドレス *</label>
                            <input type="email" class="form-control" id="patient-email" name="patient-email" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="patient-phone">電話番号 *</label>
                            <input type="tel" class="form-control" id="patient-phone" name="patient-phone" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="booking-type">予約種類 *</label>
                            <select class="form-control" id="booking-type" name="booking-type" required>
                                <option value="">選択してください</option>
                                <!-- オプションはJavaScriptで動的に追加されます -->
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="booking-date">予約希望日 *</label>
                            <input type="date" class="form-control" id="booking-date" name="booking-date" required>
                        </div>

                        <div class="form-group" id="time-slots" style="display:none;">
                            <label class="form-label">予約時間 *</label>
                            <div id="time-slots-container">
                                <!-- 時間枠がここに表示されます -->
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="patient-notes">備考（任意）</label>
                            <textarea class="form-control" id="patient-notes" name="patient-notes" rows="3" placeholder="病院へのメッセージがあればお書きください"></textarea>
                        </div>

                        <button type="submit" id="submit-booking" class="btn btn--primary btn--full-width">予約する</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 管理者ログイン画面 -->
    <div id="admin-login-screen" class="screen">
        <div class="container">
            <div class="card admin-login-card">
                <div class="card__header">
                    <h2>管理者ログイン</h2>
                </div>
                <div class="card__body">
                    <form id="admin-login-form" novalidate>
                        <div class="form-group">
                            <label class="form-label" for="admin-password">パスワード</label>
                            <input type="password" class="form-control" id="admin-password" name="admin-password" required>
                        </div>
                        <div class="flex gap-8">
                            <button type="submit" class="btn btn--primary">ログイン</button>
                            <button type="button" id="back-to-main" class="btn btn--outline">戻る</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 管理者画面 -->
    <div id="admin-screen" class="screen">
        <div class="container">
            <header class="header">
                <h1>管理者画面</h1>
                <button type="button" id="admin-logout-btn" class="btn btn--outline btn--sm">ログアウト</button>
            </header>

            <!-- タブナビゲーション -->
            <div class="tab-nav">
                <button type="button" class="tab-btn active" data-tab="dashboard">ダッシュボード</button>
                <button type="button" class="tab-btn" data-tab="bookings">予約管理</button>
                <button type="button" class="tab-btn" data-tab="types">予約種類</button>
                <button type="button" class="tab-btn" data-tab="settings">設定</button>
                <button type="button" class="tab-btn" data-tab="backup">バックアップ</button>
            </div>

            <!-- ダッシュボードタブ -->
            <div id="dashboard-tab" class="tab-content active">
                <div class="grid grid-2">
                    <div class="card">
                        <div class="card__header">
                            <h3>予約状況一覧</h3>
                        </div>
                        <div class="card__body">
                            <div class="table-controls">
                                <select id="sort-by" class="form-control" name="sort-by">
                                    <option value="date">日付順</option>
                                    <option value="type">種類順</option>
                                    <option value="name">名前順</option>
                                </select>
                                <button type="button" id="print-list" class="btn btn--outline btn--sm">印刷</button>
                            </div>
                            <div id="bookings-list" class="bookings-table">
                                <!-- 予約一覧がここに表示されます -->
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__header">
                            <h3>カレンダー表示</h3>
                        </div>
                        <div class="card__body">
                            <div class="calendar-controls">
                                <input type="date" id="calendar-date" class="form-control" name="calendar-date">
                            </div>
                            <div id="calendar-view">
                                <!-- カレンダー表示がここに表示されます -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 予約管理タブ -->
            <div id="bookings-tab" class="tab-content">
                <div class="card">
                    <div class="card__header">
                        <h3>予約管理</h3>
                    </div>
                    <div class="card__body">
                        <div id="admin-bookings-list">
                            <!-- 管理用予約一覧がここに表示されます -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 予約種類タブ -->
            <div id="types-tab" class="tab-content">
                <div class="card">
                    <div class="card__header">
                        <h3>予約種類管理</h3>
                        <button type="button" id="add-type-btn" class="btn btn--primary btn--sm">新規追加</button>
                    </div>
                    <div class="card__body">
                        <div id="booking-types-list">
                            <!-- 予約種類一覧がここに表示されます -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 設定タブ -->
            <div id="settings-tab" class="tab-content">
                <div class="grid grid-2">
                    <div class="card">
                        <div class="card__header">
                            <h3>パスワード変更</h3>
                        </div>
                        <div class="card__body">
                            <form id="password-change-form" novalidate>
                                <div class="form-group">
                                    <label class="form-label" for="new-password">新しいパスワード</label>
                                    <input type="password" class="form-control" id="new-password" name="new-password" required>
                                </div>
                                <button type="submit" class="btn btn--primary">変更</button>
                            </form>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__header">
                            <h3>病院メッセージ</h3>
                        </div>
                        <div class="card__body">
                            <form id="message-form" novalidate>
                                <div class="form-group">
                                    <label class="form-label" for="hospital-message-input">メッセージ</label>
                                    <textarea class="form-control" id="hospital-message-input" name="hospital-message-input" rows="4"></textarea>
                                </div>
                                <button type="submit" class="btn btn--primary">更新</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- バックアップタブ -->
            <div id="backup-tab" class="tab-content">
                <div class="grid grid-2">
                    <div class="card">
                        <div class="card__header">
                            <h3>データバックアップ</h3>
                        </div>
                        <div class="card__body">
                            <p>システムの全データをバックアップファイルとしてダウンロードします。</p>
                            <button type="button" id="backup-btn" class="btn btn--primary">バックアップ作成</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__header">
                            <h3>データ復元</h3>
                        </div>
                        <div class="card__body">
                            <p>バックアップファイルからデータを復元します。</p>
                            <input type="file" id="restore-file" name="restore-file" accept=".json" class="form-control">
                            <button type="button" id="restore-btn" class="btn btn--primary mt-8">復元実行</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- モーダル -->
    <div id="modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">タイトル</h3>
                <button type="button" id="modal-close" class="btn btn--outline btn--sm">×</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- モーダルコンテンツがここに表示されます -->
            </div>
        </div>
    </div>

    <!-- 予約種類編集フォーム（テンプレート） -->
    <template id="type-form-template">
        <form class="type-form" novalidate>
            <div class="form-group">
                <label class="form-label">予約種類名</label>
                <input type="text" class="form-control type-name" name="type-name" required>
            </div>
            <div class="form-group">
                <label class="form-label">時間間隔（分）</label>
                <input type="number" class="form-control type-interval" name="type-interval" min="5" max="120" value="15">
            </div>
            <div class="form-group">
                <label class="form-label">定員数</label>
                <input type="number" class="form-control type-capacity" name="type-capacity" min="1" max="100" value="10">
            </div>
            <div class="form-group">
                <label class="form-label">開始時間</label>
                <input type="time" class="form-control type-start-time" name="type-start-time" value="09:00">
            </div>
            <div class="form-group">
                <label class="form-label">終了時間</label>
                <input type="time" class="form-control type-end-time" name="type-end-time" value="17:00">
            </div>
            <div class="form-group">
                <label class="form-label">営業曜日</label>
                <div class="weekday-checkboxes">
                    <label><input type="checkbox" name="weekdays" value="1" checked> 月</label>
                    <label><input type="checkbox" name="weekdays" value="2" checked> 火</label>
                    <label><input type="checkbox" name="weekdays" value="3" checked> 水</label>
                    <label><input type="checkbox" name="weekdays" value="4" checked> 木</label>
                    <label><input type="checkbox" name="weekdays" value="5" checked> 金</label>
                    <label><input type="checkbox" name="weekdays" value="6"> 土</label>
                    <label><input type="checkbox" name="weekdays" value="0"> 日</label>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">予約開始日</label>
                <input type="date" class="form-control type-available-from" name="type-available-from">
            </div>
            <div class="form-group">
                <label class="form-label">予約終了日</label>
                <input type="date" class="form-control type-available-to" name="type-available-to">
            </div>
            <div class="form-group">
                <label class="form-label">休日設定（yyyy-mm-dd形式、カンマ区切り）</label>
                <textarea class="form-control type-holidays" name="type-holidays" rows="2" placeholder="2025-01-01,2025-12-31"></textarea>
            </div>
            <div class="flex gap-8">
                <button type="submit" class="btn btn--primary">保存</button>
                <button type="button" class="btn btn--outline modal-close">キャンセル</button>
            </div>
        </form>
    </template>

    <!-- JavaScript を最後に読み込み -->
    <script src="app.js"></script>
    
    <!-- デバッグ用のスクリプト -->
    <script>
        // ページ読み込み後に実行される確認用コード
        window.addEventListener('load', function() {
            console.log('Page fully loaded');
            
            // 主要な要素が存在するかチェック
            const adminBtn = document.getElementById('admin-login-btn');
            const bookingType = document.getElementById('booking-type');
            const bookingForm = document.getElementById('booking-form');
            
            console.log('Admin button:', adminBtn ? 'Found' : 'Missing');
            console.log('Booking type select:', bookingType ? 'Found' : 'Missing');
            console.log('Booking form:', bookingForm ? 'Found' : 'Missing');
            
            // イベントリスナーのテスト用（管理者ボタン）
            if (adminBtn) {
                console.log('Adding click listener to admin button');
                adminBtn.onclick = function() {
                    console.log('Admin button clicked directly');
                    alert('管理者ボタンがクリックされました');
                };
            }
        });
    </script>
</body>
</html>
