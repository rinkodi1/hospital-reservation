<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>病院予約システム</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>
<body>
    <!-- Patient View (Main Screen) -->
    <div id="patientView">
        <div class="container">
            <header class="header">
                <h1>病院予約システム</h1>
                <button id="adminLoginBtn" class="btn btn--outline btn--sm">管理者ログイン</button>
            </header>

            <!-- Patient Message Area -->
            <div class="patient-message-area">
                <div class="card">
                    <div class="card__body">
                        <p id="patientMessage">当院のオンライン予約システムへようこそ。ご予約をお取りください。</p>
                    </div>
                </div>
            </div>

            <!-- Reservation Form -->
            <div class="reservation-form">
                <div class="card">
                    <div class="card__body">
                        <h2>予約フォーム</h2>
                        <form id="reservationForm">
                            <div class="form-group">
                                <label class="form-label" for="patientName">お名前 *</label>
                                <input type="text" id="patientName" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="patientEmail">メールアドレス *</label>
                                <input type="email" id="patientEmail" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="patientPhone">電話番号 *</label>
                                <input type="tel" id="patientPhone" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="appointmentType">予約の種類 *</label>
                                <select id="appointmentType" class="form-control" required>
                                    <option value="">選択してください</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="appointmentDate">予約希望日 *</label>
                                <input type="date" id="appointmentDate" class="form-control" required>
                            </div>
                            
                            <div class="form-group" id="timeSlotGroup" style="display: none;">
                                <label class="form-label">予約希望時間 *</label>
                                <div id="timeSlots" class="time-slots"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="remarks">備考（病院へのメッセージ）</label>
                                <textarea id="remarks" class="form-control" rows="3" placeholder="何かございましたらお書きください"></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn--primary btn--full-width">予約を確定する</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <h3>管理者ログイン</h3>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label class="form-label" for="adminPassword">パスワード</label>
                    <input type="password" id="adminPassword" class="form-control" required>
                </div>
                <div class="flex gap-8">
                    <button type="button" id="cancelLogin" class="btn btn--secondary">キャンセル</button>
                    <button type="submit" class="btn btn--primary">ログイン</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin View -->
    <div id="adminView" class="hidden">
        <div class="admin-header">
            <h1>管理画面</h1>
            <button id="logoutBtn" class="btn btn--outline">ログアウト</button>
        </div>

        <nav class="admin-nav">
            <button class="nav-btn active" data-tab="dashboard">ダッシュボード</button>
            <button class="nav-btn" data-tab="reservations">予約管理</button>
            <button class="nav-btn" data-tab="appointment-types">予約種類管理</button>
            <button class="nav-btn" data-tab="settings">システム設定</button>
            <button class="nav-btn" data-tab="reports">レポート・印刷</button>
            <button class="nav-btn" data-tab="backup">バックアップ</button>
        </nav>

        <div class="admin-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2>ダッシュボード</h2>
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <h3>本日の予約数</h3>
                        <div class="stat-number" id="todayReservations">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>今月の予約数</h3>
                        <div class="stat-number" id="monthReservations">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>登録済み予約種類</h3>
                        <div class="stat-number" id="appointmentTypesCount">0</div>
                    </div>
                </div>
                <div class="recent-reservations">
                    <h3>最近の予約</h3>
                    <div id="recentReservationsList"></div>
                </div>
            </div>

            <!-- Reservations Tab -->
            <div id="reservations" class="tab-content">
                <h2>予約管理</h2>
                <div class="reservation-controls">
                    <input type="text" id="searchInput" class="form-control" placeholder="検索（名前、メール）" style="width: 200px;">
                    <select id="sortBy" class="form-control" style="width: 150px;">
                        <option value="date">日付順</option>
                        <option value="name">名前順</option>
                        <option value="type">種類順</option>
                    </select>
                    <button id="toggleCalendarView" class="btn btn--secondary">カレンダー表示</button>
                </div>
                <div id="reservationTableView">
                    <table id="reservationsTable" class="data-table">
                        <thead>
                            <tr>
                                <th>日付</th>
                                <th>時間</th>
                                <th>種類</th>
                                <th>名前</th>
                                <th>メール</th>
                                <th>電話</th>
                                <th>備考</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div id="reservationCalendarView" class="hidden">
                    <div class="calendar-controls">
                        <input type="month" id="calendarMonth" class="form-control">
                    </div>
                    <div id="calendar"></div>
                </div>
            </div>

            <!-- Appointment Types Tab -->
            <div id="appointment-types" class="tab-content">
                <h2>予約種類管理</h2>
                <button id="addAppointmentType" class="btn btn--primary">新しい予約種類を追加</button>
                <div id="appointmentTypesList"></div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <h2>システム設定</h2>
                
                <div class="settings-section">
                    <h3>管理者パスワード変更</h3>
                    <form id="passwordChangeForm">
                        <div class="form-group">
                            <label class="form-label">新しいパスワード</label>
                            <input type="password" id="newPassword" class="form-control">
                        </div>
                        <button type="submit" class="btn btn--primary">パスワードを変更</button>
                    </form>
                </div>

                <div class="settings-section">
                    <h3>患者へのメッセージ</h3>
                    <div class="form-group">
                        <textarea id="patientMessageInput" class="form-control" rows="4"></textarea>
                    </div>
                    <button id="updatePatientMessage" class="btn btn--primary">メッセージを更新</button>
                </div>

                <div class="settings-section">
                    <h3>予約完了メールテンプレート</h3>
                    <div class="form-group">
                        <textarea id="emailTemplateInput" class="form-control" rows="6"></textarea>
                        <small class="form-help">{{name}}, {{type}}, {{date}}, {{time}} のプレースホルダーが使用できます</small>
                    </div>
                    <button id="updateEmailTemplate" class="btn btn--primary">テンプレートを更新</button>
                </div>

                <div class="settings-section">
                    <h3>EmailJS設定</h3>
                    <div class="form-group">
                        <label class="form-label">Service ID</label>
                        <input type="text" id="emailjsServiceId" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Template ID</label>
                        <input type="text" id="emailjsTemplateId" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Public Key</label>
                        <input type="text" id="emailjsPublicKey" class="form-control">
                    </div>
                    <button id="testEmailjs" class="btn btn--secondary">接続テスト</button>
                    <button id="saveEmailjsSettings" class="btn btn--primary">設定を保存</button>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <h2>レポート・印刷</h2>
                <div class="report-controls">
                    <select id="printAppointmentType" class="form-control">
                        <option value="">全ての種類</option>
                    </select>
                    <input type="date" id="printStartDate" class="form-control">
                    <span>から</span>
                    <input type="date" id="printEndDate" class="form-control">
                    <span>まで</span>
                    <button id="generateReport" class="btn btn--primary">レポート生成</button>
                    <button id="printReport" class="btn btn--secondary">印刷</button>
                </div>
                <div id="reportContent"></div>
            </div>

            <!-- Backup Tab -->
            <div id="backup" class="tab-content">
                <h2>バックアップ・復元</h2>
                <div class="backup-section">
                    <h3>データのバックアップ</h3>
                    <button id="exportData" class="btn btn--primary">データをエクスポート</button>
                    <button id="autoBackup" class="btn btn--secondary">自動バックアップをダウンロード</button>
                </div>
                <div class="backup-section">
                    <h3>データの復元</h3>
                    <input type="file" id="importFile" accept=".json">
                    <button id="importData" class="btn btn--warning">データをインポート</button>
                    <p class="backup-warning">注意: インポートすると現在のデータは上書きされます</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Reservation Modal -->
    <div id="editReservationModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <h3>予約編集</h3>
            <form id="editReservationForm">
                <input type="hidden" id="editReservationId">
                <div class="form-group">
                    <label class="form-label">名前</label>
                    <input type="text" id="editName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">メールアドレス</label>
                    <input type="email" id="editEmail" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">電話番号</label>
                    <input type="tel" id="editPhone" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">日付</label>
                    <input type="date" id="editDate" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">時間</label>
                    <input type="time" id="editTime" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">備考</label>
                    <textarea id="editRemarks" class="form-control" rows="3"></textarea>
                </div>
                <div class="flex gap-8">
                    <button type="button" id="cancelEdit" class="btn btn--secondary">キャンセル</button>
                    <button type="submit" class="btn btn--primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Appointment Type Modal -->
    <div id="appointmentTypeModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content large">
            <h3 id="appointmentTypeModalTitle">予約種類の追加</h3>
            <form id="appointmentTypeForm">
                <input type="hidden" id="appointmentTypeId">
                <div class="form-group">
                    <label class="form-label">種類名</label>
                    <input type="text" id="appointmentTypeName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">時間間隔（分）</label>
                    <input type="number" id="appointmentTypeDuration" class="form-control" value="15" min="5" max="60">
                </div>
                <div class="form-group">
                    <label class="form-label">最大予約枠数</label>
                    <input type="number" id="appointmentTypeCapacity" class="form-control" value="10" min="1" max="50">
                </div>
                <div class="form-group">
                    <label class="form-label">開始時間</label>
                    <input type="time" id="appointmentTypeStartTime" class="form-control" value="09:00">
                </div>
                <div class="form-group">
                    <label class="form-label">終了時間</label>
                    <input type="time" id="appointmentTypeEndTime" class="form-control" value="17:00">
                </div>
                <div class="form-group">
                    <label class="form-label">予約可能期間開始</label>
                    <input type="date" id="appointmentTypeAvailableFrom" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">予約可能期間終了</label>
                    <input type="date" id="appointmentTypeAvailableTo" class="form-control">
                </div>
                <div class="flex gap-8">
                    <button type="button" id="cancelAppointmentType" class="btn btn--secondary">キャンセル</button>
                    <button type="submit" class="btn btn--primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
